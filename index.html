<!DOCTYPE html>
<html>
<head>
    <title>Green Potential Model with Layer Control</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha20-g/f4zY3s79lW6nNqF5hXl0gU5D2hX7gX3jQ0U5TzP0Q6S2pX9gX4t0Q7R5zF2" crossorigin="" />

    <style>
        #map { height: 100vh; width: 100%; }
        body { margin: 0; padding: 0; }
    </style>
</head>
<body>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha20-g/f4zY3s79lW6nNqF5hXl0gU5D2hX7gX3jQ0U5TzP0Q6S2pX9gX4t0Q7R5zF2" crossorigin=""></script>

    <script>
        var map = L.map('map').setView([52.00, 4.36], 13);

        var baseLayer = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
            maxZoom: 19,
            attribution: '© OpenStreetMap contributors & © CARTO'
        }).addTo(map);

        var overlayLayers = {};

        function loadGeoJsonLayer(url, name, styleOptions, addToMap = false) {
            return new Promise((resolve, reject) => {
                fetch(url)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status} for ${url}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        var geoJsonLayer = L.geoJson(data, {
                            style: function (feature) {
                                return styleOptions;
                            },
                            pointToLayer: function (feature, latlng) {
                                return L.circleMarker(latlng, styleOptions);
                            }
                        });

                        if (addToMap) {
                            geoJsonLayer.addTo(map);
                        }

                        overlayLayers[name] = geoJsonLayer;
                        resolve(geoJsonLayer);
                    })
                    .catch(error => {
                        console.error(`Error loading GeoJSON from ${url}:`, error);
                        reject(error);
                    });
            });
        }

        Promise.all([
            loadGeoJsonLayer(
                'data/processed/merged_tree_area.geojson',
                'Tree Area',
                {
                    fillColor: '#1A9988',
                    fillOpacity: 1,
                    weight: 1
                },
                true
            ),
            loadGeoJsonLayer(
                'data/processed/merged_building_area_buffer.geojson',
                'Building Buffer',
                {
                    fillColor: '#E9EDEE',
                    fillOpacity: 1,
                    weight: 1
                },
                true
            ),
            loadGeoJsonLayer(
                'data/processed/total_restriction_area.geojson',
                'Restriction Area',
                {
                    color: '#EB5600',
                    fillColor: '#EB5600',
                    fillOpacity: 0,
                    weight: 3
                },
                false
            )
        ]).then(() => {
            var baseMaps = {
                "CARTO Light": baseLayer
            };

            L.control.layers(baseMaps, overlayLayers).addTo(map);
        }).catch(error => {
            console.error("One or more GeoJSON layers failed to load:", error);
        });
    </script>
</body>
</html>
